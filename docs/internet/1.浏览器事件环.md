# 浏览器事件环

## 进程和线程之间的关系

计算机分配任务是以进程来进行分配的，进程中包含线程

浏览器是一个进程，而且是一个多进程模型（多进程的好处就是其中一个进程挂掉来，不会影响其他的进程）

一个tab就是一个独立的进程（渲染进程）

浏览器默认就是有一个主进程，来调度其他的进程（进程间的通信）

## 渲染进程

+ ui渲染进程 - 负责页面渲染、布局、绘制
+ js引擎线程 - 执行js代码

ui渲染进程和js引擎线程是互斥的：js可以操作dom，渲染需要dom，如果正在渲染页面的时候，渲染到一半来如果js要求把dom删除掉的时候如果不是互斥的就会出现冲突，为了避免这种冲突存在所以js在设计的过程汇总也是单线程的

js的单线程指代的主要是主线程（默认代码是从上到下依次执行的），定时器，发请求，用户事件（在主线程执行的时候，还是会创建一些独立的线程）

## 异步

1. 异步任务的优先级，宏任务和微任务执行时机不一样

+ 宏任务macro-task： 定时器（setTimeout）、发请求、用户事件、messageChannel(消息通道)、写的script脚本、ui渲染、setImmdiate(ie下有，比settimeout性能好)
+ 微任务micro-task：Promise.then(语言本身提供的)、queueMicrotask、MutationObserver(异步监控dom的变化)

requestFrameAnimation、requestAdleCallback这两个函数主要是发生在渲染过程里，就是个回掉函数，这个东西不应该分到宏任务和微任务当中去

2. js脚本的执行顺序是怎么进行定义的

先执行当前的同步代码，再去执行异步代码，有一个单独的线程扫描异步任务，也就是事件触发线程即EventLoop，不断的进行轮询

代码在执行的过程中会产生微任务和宏任务

当发生的宏任务时间到达的时候会被发入到宏任务队列中（加入回调），宏任务只有一个队列

微任务时立刻放到队列中（每一次执行宏任务的时候都会产生一个微任务队列）

当前宏任务执行完毕后，会清空本轮产生的微任务，如果执行微任务的时候又产生了微任务，会放到当前微任务的尾部，直至清空微任务为止

此时看一眼时候需要渲染页面，如果要渲染就渲染（通过requestFrameAnimation、requestAdleCallback），刷新频率是16.6ms

再去扫描宏任务队列，如果有则取出第一个宏任务，再去执行

每次微任务是执行一批，宏任务是执行一个

## 面试题

