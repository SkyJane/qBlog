# 封装ajax

```js
function _ajax (method, url, params, callback) {
    method = method.toUpperCase()
    let _params = ''

    if (method === 'GET') {
        if (typeof params === 'object') {
            Object.keys(params).forEach((el, index) => {
                _params += `${index === 0 ? '?' : '&'}${el}=${params[el]}`
            })
        } else {
            _params = params
        }
    } else {
        _params = params
    }
    
    const xhr = new XMLHttpRequest()
    xhr.onreadystatechange = function (e) {
      if (xhr.readyState !== 4) return 
      callback(xhr.responseText)
    }
    if (method === 'POST') {
        xhr.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded')
        xhr.send(post_params)
    } else {
        xhr.open(method, url + _params, false)
    }
}

_ajax('GET', 'http://www.baidu.com', { a: 1, b: 2 }, data => console.log(data))
```

## 请用JS实现Ajax并发请求控制

实现一个批量请求函数 multiRequest(urls, maxNum), 要求如下：

+ 要求最大的并发数maxNum
+ 每当有一个请求返回，就留下一个空位，可以增加新的请求
+ 所有请求完成后，结果按照urls里面的顺序依次打出
  
## 场景

假设现在有这么一种场景：现有 30 个异步请求需要发送，但由于某些原因，我们必须将同一时刻并发请求数量控制在 5 个以内，同时还要尽可能快速的拿到响应结果。

## 思路分析

整体采用递归调用来实现：最初发送的请求数量上限为允许的最大值，并且这些请求中的每一个都应该在完成时继续递归发送，通过传入的索引来确定了urls里面具体是那个URL，保证最后输出的顺序不会乱，而是依次输出。

## 代码实现

```js

```